
###蓝牙低功耗说明
这一章描述了ble协议栈的不同层，这些层包含的组件，和他们的概念
####2.1 GAP层(通用接入规范)
GAP是蓝牙协议栈最底层的应用程序接口。它包含管理广播和连接等的一些参数。
note：

#####2.1.1  角色
#####2.1.2  广播
#####2.1.3  扫描
#####2.1.4  初始化
#####2.1.5  连接


####2.2GATT(通用属性配置)
GATT是数据实际上被用来转移的一层

#####2.2.1 角色
除了GAP中的角色之外，BLE也定义的两个角色，一个GATT服务器和一个GATT客户端，那完全独立于GAP的角色。这个概念意味着当他包含数据的时候作为一个服务器，当作为一个访问的时候，它是一个客户端
对于led，按键的例子，外围设备（带有led灯和按键——作为服务器的角色，中心设备作为客户端的角色
#####2.2.2 GATT的层级
一个GATT服务器通过调用一个属性表来组织数据并且那些包含的真实的数据就是属性
######2.2.2.1 属性
一个属性包括一个句柄，一个UUID，和一个值。一个句柄是GATT表中属性的索引，并且是唯一的对于每个设备中的每个属性。UUID包含有属性的数据类型的信息，对于理解包含的属性值是关键的。UUID将不是唯一的在一个设备内有几个属性可能带有相同的UUID。
######2.2.2.2 特征值
一个特征至少包含两个属性：一个特征的定义和一个持有特征值得属性
对于LED按键的例子，我们使用特征代表当前的按键状态和当前led灯的状态
######2.2.2.3 描述符
任何宣称不是特征值的属性，都被定义成一个描述符。一个描述符可以提供更多的关于特征值得信息，例如可读的特征值得描述
然而有一个特殊的描述符特别值得一提：（CCCD),这个描述符被增加到任何支持通知或者知识属性的特征值里。详情查看2.2.5节，第10页，On-air operations and properties.
写“1”到CCCD打开通知，写“2”打开指示。写“0”关闭通知和指示
对于S110 SoftDevice 这个描述符被自动增加到通知和指示被设置的特征值的地方
######2.2.2.4 服务
一个服务包含一个或者更多的特征值，那是一个逻辑相关的特征值集合   
对于LED灯按键的例子，所有的特征值都被分组到一个服务  
######2.2.2.4 规范
一个规范被定义成一个或多个服务用例的配置文件。一个配置文档包括服务的信息和它怎样被使用。因此，这个文档包含各种各样的广播信息，和被使用的连接的时间间隔，安全性是否被需要等等   
值得注意的是一个规范并在属性表中并没有一个属性   
对于led和按键的例子，规范没有显示的描述   
#####2.2.3与标准相对的自定义服务和特征值
Bluetooth SIG基于GATT层的协议栈定义了规范，服务，特征值和属性的序号。然而蓝牙低功耗所有服务的实现是应用程序的一部分，而不是协议栈的一部分，那就意味着应用程序可以支持任何想要的规范和服务，只要协议栈支持GATT   
因为支持应用中的规范和服务，所以在程序中实现自定义的服务是可能的    
对于LED灯和按键的例子，没有涵盖Bluetooth SIG服务的用例，因此它将被实现为带着两个特征值得一个自定义服务

#####2.2.4 UUIDs

######2.2.4.1 UUID

######2.2.4.2 Alias

#####2.2.5 空中操作和属性

######2.2.5.1 写和不带反馈的写
 
######2.2.5.2 读

######2.2.5.3  通知和指示


###迷你的BLE应用预览

####3.2 S110 SoftDevice
####3.3 广播
####3.4 连接参数
SDK来自于一个称为  ble_conn_params 模块，它管理着连接参数的更新，随着需要。它对于应用调用的SoftDevice的API进行了封装，包括处理定时器的请求。   
在初始化结构体 ble_conn_params_init_t中，不同的参数更新程序能被设置。例如，它是否应该开始连接，在写一个特定CCCD的时候是否开始，哪种连接参数应该被使用，在请求被发送前是否延时，等等。  

####3.5 服务
####3.6 特征值

###LED Button应用例程 
####4.1 代码预览
一个应用怎样工作的预览在下面章节被提供帮助你理解和使用代码

#####4.1.1 代码分离
例程代码被分成三个文件：
 >>
  * main.c
  * ble_lbs.c
  * ble_libs.h

这个结构与其他的SDK例程是相似的，main.c执行主程序，分开的服务文件执行服务和它自己的代码。所有的I/O处理由应用决定  
#####4.1.2  code流程
任何运行在NRF51822芯片的BLE应用的基础流程是初始化所有需要的部分，开始广播，接下俩可能进入低功耗模式等待BLE事件。在事件收到的时候，它会转到相应的BLE服务和模块。一个事件，但不限于以下之一：

>>
 * 一个对等的设备连接NRF51822
 * 一个对等的设备写一个特征值
 * 一个指示广播有超时的指示  

流程是应用非常的模块化，并且一个服务能被增加到应用中通过初始化它，并确保它的事件句柄在事件到来的时候被调用

#####4.1.3  进入Keil项目 

我们建议你编译例程在你开始浏览它之前。在它被编译之后，你能右键进入任何的函数，变量，类型，或者宏定义，进入它定义的地方，通过选择 Go To Definition Of 或者 Go To Reference To  
Go To Definition Of带你进入实际方法的实现（即，源代码文件），Go To Reference To带你进入他的头文件声明。